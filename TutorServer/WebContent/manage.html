<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>家教通APP管理员系统</title>

<link href="static/lib/bootstrap-3.3.7-dist/css/bootstrap.css" rel="stylesheet">
<script src="static/lib/jquery-1.12.4.js" type="text/javascript" charset="UTF-8"></script>
<script src="static/lib/bootstrap-3.3.7-dist/js/bootstrap.js" type="text/javascript" charset="UTF-8"></script>
<script src="static/js/register-util.js" type="text/javascript" charset="UTF-8"></script>

<style type="text/css">
	header{
		background-color: #09F;
		height: 50px;
	}
	
	header div{
		text-align: center;
		height: 50px;
		font-size: 40px;
	}
	
	.first{
		height: 45px;
		font-size: 20px;
		margin-top: 10px;
	}
	
	.select1{
		width:110px;
		height:30px;
	}
	
	.datalist-title {
		margin-top:5px;
		border-top: 1px solid #ddd;
		font-weight: 600;
		height: 30px;
		line-height: 30px;
	}
	
	.table-title {
		font-size: 14px;
		font-weight: 600;
		color: rgb(70, 128, 50);
		padding: 0 25px;
		margin-top:10px;
	}
	
	.refresh{
		float:right;
	}
	.table1{
		margin-left:100px;
		margin-top:10px;
		width:1700px;
	}
	.modal1{
		margin-left:100px;
		margin-right:100px;
		margin-top:200px;
	}

	input,th,tr{
		border:none;
		text-align:center;
	}
	
</style>
</head>

<body id="body">
	<header>
    	<div class="bg-primary">
        	家教通APP管理员系统
        </div>
    </header>
    
    <div class="first">
		<span>管理员用户名</span> <input type="text" id="administrator" readonly>
	</div>
    <div>
    	<select class="select1" id="select">
			<option>教师信息管理</option>
			<option>学生信息管理</option>
		</select>

		<span class="btn btn-primary" data-toggle="modal" data-target="#myModal"><i class="glyphicon glyphicon-plus"></i>添加</span>
		<span class="btn btn-primary " data-toggle="modal" data-target="#myModal1" id="delete" ><i class="glyphicon glyphicon-trash"></i>删除</span>
		<span class="btn btn-primary" data-toggle="modal" data-target="#myModal2" id="alter1"><i class="glyphicon glyphicon-list-alt"></i>修改</span>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal1">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					添加用户
				</h4>
			</div>
			<div class="modal-body">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>用户名</th>
							<th>密码</th>
							<th>性别</th>
							<th>年龄</th>
							<th>身份</th>
							<th>手机号</th>
						</tr>
					</thead>
					<tbody >
						<tr>
							<th><input id="username"/></th>
							<th><input id="password"/></th>
							<th>
								<select id="sex">
									<option>男</option>
									<option>女</option>
								</select>
							</th>
							<th><input id="age"/></th>
							<th>
								<select id="type">
									<option>学生</option>
									<option>教师</option>
									<option>管理员</option>
								</select>
							</th>
							<th><input id="phone"/></th>
						</tr>

					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button id="commit" type="button" class="btn btn-primary">
					提交
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					删除用户
				</h4>
			</div>
			<div class="modal-body" >
				<h3 >确认删除?</h3>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消
				</button>
				<button id="yes" type="button" class="btn btn-primary">
					确定
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>


<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal1">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					修改用户信息
				</h4>
			</div>
			<div class="modal-body">
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>ID</th>
							<th>昵称</th>
							<th>用户名</th>
							<th>性别</th>
							<th>年龄</th>
							<th>身份</th>
							<th>手机号</th>
							<th>地址</th>
						</tr>
					</thead>
					<tbody >
						<tr>
							<th><input id="id2" readonly/></th>
							<th><input id="net_name2"/></th>
							<th><input id="username2"/></th>
							<th>
								<select id="sex2">
									<option>男</option>
									<option>女</option>
								</select>
							</th>
							<th><input id="age2"/></th>
							<th><input id="type2" readonly/></th>
							<th><input id="phone2"/></th>
							<th><input id="address2"/></th>
						</tr>

					</tbody>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>
				<button id="alter" type="button" class="btn btn-primary">
					修改
				</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>




















    </div>
    <div>
    	<div class="datalist-title table1">
			<span class="table-title">信息列表</span> 
			<span class="btn refresh" id="refresh"><i class="glyphicon glyphicon-refresh"></i>刷新</span>
		</div>
   		<table class="table table-bordered table1" id="table">
   			<thead>
				<tr>
					<th></th>
					<th>ID</th>
					<th>昵称</th>
					<th>用户名</th>
					<th>性别</th>
					<th>年龄</th>
					<th>手机号</th>
					<th>地址</th>
				</tr>
			</thead>
			<tbody id="showData">


			</tbody>
		</table>
    </div>
    <script src="static/lib/jquery-1.12.4.js" type="text/javascript"
		charset="UTF-8"></script>
		
	<script type="text/javascript">
	function getQueryString(name) {
		  var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
		  var r = window.location.search.substr(1).match(reg);
		  if (r != null) {
		    return unescape(r[2]);
		  }
		  return null;
		}
		var id = getQueryString("id");
		console.info("id:"+id);
		$("#administrator").attr("value",id);
		fresh();
		var type = 0;
		$("#select").click(function(){
			var str = $(this).val();
			if(str == "学生信息管理"){
				type = 1;
			}else if(str == "教师信息管理"){
				type = 0;
			}
			
			fresh();
		});
		fresh();
		$("#refresh").click(function(){
			fresh();
		})
		$("#delete").click(function(){

			var tr = $("#showData").children("tr").children("td").children("input[name='select']:checked");
			var id = tr.parent().parent().children("td").eq(1).text();
			var username = tr.parent().parent().children("td").eq(2).text();
			var sex = tr.parent().parent().children("td").eq(3).text();
			var age = tr.parent().parent().children("td").eq(4).text();
			var phone = tr.parent().parent().children("td").eq(5).text();	

			$("#yes").click(function(){
				if(id != ""){
					$.ajax({
						url:"http://localhost:8080/TutorApp/DeleteUser",
						type:"post",
						data:{
							id:id
							},
						//dataType:"json",//声明返回格式类型
						error:function(e){ 
							alert(e);
						},
						success:function(e){
							console.info(e)
							if(e == 0){
								alert("删除成功");

							}else{
								alert("删除失败");
							}
							fresh();
						}
						});
					}else{
						alert("请选择用户");
					}
				})
			})
			
		$("#commit").click(function(){
			var username = $("#username").val();
			var password = $("#password").val();
			var sex = ('男' == $("#sex").val() ? 0: 1);
			var age = $("#age").val();
			var type = ('教师' == $("#type").val() ? 0 : 1);
			var phone = $("#phone").val();
			
			if($("#administrator").val() != null){
				$.ajax({
					url:"http://localhost:8080/TutorApp/AddUser",
					type:"post",
					data:{
						username:username,
						password:password,
						sex:sex,
						age:age,
						type:type,
						phone:phone
						},
					//dataType:"json",//声明返回格式类型
					error:function(e){ 
						alert(e);
					},
					success:function(e){
						console.info(e)
						if(e == 0){
							alert("添加成功");
							$("#username").val('');
							$("#password").val('');
							$("#age").val('');
							$("#phone").val('');
						}else if(e == 1){
							alert("用户已存在");
						}else{
							alert("添加失败");
						}
						fresh();
					}
				});
			}else{
				alert("您未登陆");
			}
		})
		
		
		
		$("#alter1").click(function(){
			var tr = $("#showData").children("tr").children("td").children("input[name='select']:checked");

			var id = tr.parent().parent().children("td").eq(1).text();
			var net_name = tr.parent().parent().children("td").eq(2).text();
			var username = tr.parent().parent().children("td").eq(3).text();
			var sex = tr.parent().parent().children("td").eq(4).text();
			var age = tr.parent().parent().children("td").eq(5).text();
			var phone = tr.parent().parent().children("td").eq(6).text();
			var address = tr.parent().parent().children("td").eq(7).text();
			var type = 0;
			var str = $("#select").val();
			if(str == "学生信息管理"){
				type = 1;
			}else if(str == "教师信息管理"){
				type = 0;
			}

			console.info(id+" "+net_name+" "+username+" "+sex+" "+age+" "+phone+" "+address);
				
				$("#id2").val(id);
				$("#net_name2").val(net_name);
				$("#username2").val(username);
				$("#age2").val(age);
				console.info("type 的"+type);
				$("#type2").val(type == 0?"教师":"学生");
				$("#phone2").val(phone);
				$("#address2").val(address);
					
			
		})
		
		$("#alter").click(function(){
					
					if(id == ""){		
						alert("请选择用户");
					}else{
						var id = $("#id2").val();
						var net_name = $("#net_name2").val();
						var username = $("#username2").val();
						var sex = $("#sex2").val();
						var age = $("#age2").val();
						var phone = $("#phone2").val();
						var address = $("#address2").val();
	
						$.ajax({
							url:"http://localhost:8080/TutorApp/AlterUser",
							type:"post",
							data:{
								"id":id,
								"net_name":net_name,
								"username":username,
								"sex":(sex == '男'?0:1),
								"age":age,
								"phone":phone,
								"address":address
								},
							//dataType:"json",//声明返回格式类型
							error:function(e){
							},
							success:function(e){
								if(e == 0){
									alert("修改成功");
								}else{
									alert("修改失败");
								}
								fresh();

							}
						});
					}
				})
		
		
		function fresh(){
			var type = 0;
				var str = $("#select").val();
				if(str == "学生信息管理"){
					type = 1;
				}else if(str == "教师信息管理"){
					type = 0;
				}

			$.ajax({
				url:"http://localhost:8080/TutorApp/GetUser",
				type:"get",
				data:{
					type:type
					},
				dataType:"json",//声明返回格式类型
				error:function(){
					
				},
				success:function(e){
				$("#showData").html('');
				$.each(e,function(index,data){
					var html='<tr>';
					html += '<td><input type="radio" name="select"/></td>';
					html += '<td>'+data.id+'</td>';
					html += '<td>'+data.net_name+'</td>';
					html += '<td>'+data.username+'</td>';
					html += '<td>'+(0 == data.sex?'男':'女')+'</td>';
					html += '<td>'+data.age+'</td>';
					html += '<td>'+data.phone+'</td>';
					html += '<td>'+data.address+'</td>';
					html += '</tr>';
					$("#showData").append(html);
				})
				}
			});
		}
	</script>
</body>
</html>
